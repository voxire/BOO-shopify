{%- liquid
  assign section_id = section.id
  assign heading = section.settings.heading
  assign subtext = section.settings.subtext
  assign button_label = section.settings.button_label
  assign background_image = section.settings.background_image
  assign glass_enabled = section.settings.glass_enabled
  assign glass_blur = section.settings.glass_blur
  assign glass_bg_opacity = section.settings.glass_bg_opacity | divided_by: 100.0
  assign glass_border_opacity = section.settings.glass_border_opacity | divided_by: 100.0
  assign success_message = section.settings.success_message
  assign padding_top = section.settings.padding_top
  assign padding_bottom = section.settings.padding_bottom
-%}

{%- style -%}
  .newsletter-signup-{{ section_id }} {
    padding-top: {{ padding_top | times: 0.5 | round: 0 }}px;
    padding-bottom: {{ padding_bottom | times: 0.5 | round: 0 }}px;
    position: relative;
    {% if background_image != blank %}
      background-image: url('{{ background_image | image_url: width: 1400 }}');
      background-size: cover;
      background-position: center;
    {% else %}
      background-color: {{ section.settings.background_color }};
    {% endif %}
  }

  @media screen and (min-width: 750px) {
    .newsletter-signup-{{ section_id }} {
      padding-top: {{ padding_top }}px;
      padding-bottom: {{ padding_bottom }}px;
    }
  }

  .newsletter-signup-{{ section_id }}__overlay {
    position: absolute;
    inset: 0;
    background: {{ section.settings.overlay_color | color_modify: 'alpha', section.settings.overlay_opacity | divided_by: 100.0 }};
  }

  .newsletter-signup-{{ section_id }}__container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 2rem;
    position: relative;
    z-index: 2;
  }

  {% if glass_enabled %}
    .newsletter-signup-{{ section_id }}__content {
      background: rgba(255, 255, 255, {{ glass_bg_opacity }});
      backdrop-filter: blur({{ glass_blur }}px) saturate(180%);
      -webkit-backdrop-filter: blur({{ glass_blur }}px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, {{ glass_border_opacity }});
      border-radius: 20px;
      padding: 3rem 2.5rem;
      text-align: center;
    }
  {% else %}
    .newsletter-signup-{{ section_id }}__content {
      background: {{ section.settings.content_bg_color | color_modify: 'alpha', section.settings.content_bg_opacity | divided_by: 100.0 }};
      border-radius: 20px;
      padding: 3rem 2.5rem;
      text-align: center;
    }
  {% endif %}

  .newsletter-signup-{{ section_id }}__heading {
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
    color: {{ section.settings.text_color }};
  }

  .newsletter-signup-{{ section_id }}__subtext {
    margin: 0 0 2rem 0;
    font-size: 1.125rem;
    line-height: 1.6;
    color: {{ section.settings.text_color }};
    opacity: 0.85;
  }

  .newsletter-signup-{{ section_id }}__form {
    display: flex;
    gap: 1rem;
    max-width: 500px;
    margin: 0 auto;
  }

  .newsletter-signup-{{ section_id }}__input {
    flex: 1;
    padding: 1rem 1.5rem;
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    font-size: 1rem;
    background: #ffffff;
    color: #000000;
  }

  .newsletter-signup-{{ section_id }}__input::placeholder {
    color: #999999;
  }

  .newsletter-signup-{{ section_id }}__button {
    padding: 1rem 2rem;
    background: {{ section.settings.button_color }};
    color: {{ section.settings.button_text_color }};
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
    white-space: nowrap;
  }

  .newsletter-signup-{{ section_id }}__button:hover {
    transform: translateY(-1px);
    opacity: 0.9;
  }

  .newsletter-signup-{{ section_id }}__button:active {
    transform: translateY(0);
  }

  .newsletter-signup-{{ section_id }}__message {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 8px;
    display: none;
  }

  .newsletter-signup-{{ section_id }}__message--success {
    background: #d4edda;
    color: #155724;
    display: block;
  }

  .newsletter-signup-{{ section_id }}__message--error {
    background: #f8d7da;
    color: #721c24;
    display: block;
  }

  @media screen and (max-width: 768px) {
    .newsletter-signup-{{ section_id }} {
      width: 100%;
      overflow-x: hidden;
    }

    .newsletter-signup-{{ section_id }}__overlay {
      position: absolute;
      inset: 0;
    }

    .newsletter-signup-{{ section_id }}__container {
      padding: 0 1rem;
      width: 100%;
      max-width: 100%;
      position: relative;
      z-index: 2;
    }

    {% if glass_enabled %}
      .newsletter-signup-{{ section_id }}__content {
        position: relative;
        padding: 2rem 1.5rem;
        border-radius: 16px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
    {% else %}
      .newsletter-signup-{{ section_id }}__content {
        position: relative;
        padding: 2rem 1.5rem;
        border-radius: 16px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
    {% endif %}

    .newsletter-signup-{{ section_id }}__heading {
      font-size: 1.75rem;
      line-height: 1.25;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .newsletter-signup-{{ section_id }}__subtext {
      font-size: 1rem;
      margin-bottom: 1.5rem;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .newsletter-signup-{{ section_id }}__form {
      flex-direction: column;
      gap: 0.75rem;
      width: 100%;
      max-width: 100%;
    }

    .newsletter-signup-{{ section_id }}__input {
      padding: 0.875rem 1.25rem;
      font-size: 16px;
      min-height: 48px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      -webkit-appearance: none;
      border-radius: 8px;
    }

    .newsletter-signup-{{ section_id }}__button {
      width: 100%;
      max-width: 100%;
      padding: 0.875rem 1.5rem;
      min-height: 48px;
      font-size: 1rem;
      touch-action: manipulation;
      box-sizing: border-box;
      transform: none;
    }

    .newsletter-signup-{{ section_id }}__button:hover {
      transform: none;
    }

    .newsletter-signup-{{ section_id }}__button:active {
      transform: scale(0.98);
    }
  }
{%- endstyle -%}

<section class="newsletter-signup-{{ section_id }}" data-section-id="{{ section.id }}">
  <div class="newsletter-signup-{{ section_id }}__overlay"></div>
  <div class="newsletter-signup-{{ section_id }}__container">
    <div class="newsletter-signup-{{ section_id }}__content">
      {%- if heading != blank -%}
        <h2 class="newsletter-signup-{{ section_id }}__heading">{{ heading }}</h2>
      {%- endif -%}

      {%- if subtext != blank -%}
        <p class="newsletter-signup-{{ section_id }}__subtext">{{ subtext }}</p>
      {%- endif -%}

      {%- liquid
        assign form_class = 'newsletter-signup-' | append: section_id | append: '__form'
        assign form_id = 'newsletter-form-' | append: section_id
      -%}
      {%- form 'customer', class: form_class, id: form_id -%}
        <input
          type="email"
          name="contact[email]"
          class="newsletter-signup-{{ section_id }}__input"
          placeholder="{{ 'general.newsletter_form.email_placeholder' | t }}"
          required
          aria-label="{{ 'general.newsletter_form.email_placeholder' | t }}"
        >
        <button type="submit" class="newsletter-signup-{{ section_id }}__button">
          {{ button_label | default: 'Subscribe' }}
        </button>
      {%- endform -%}

      <div class="newsletter-signup-{{ section_id }}__message" id="newsletter-message-{{ section_id }}"></div>
    </div>
  </div>
</section>

<script>
  (function() {
    const form = document.getElementById('newsletter-form-{{ section_id }}');
    const message = document.getElementById('newsletter-message-{{ section_id }}');
    
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const email = formData.get('contact[email]');
      
      fetch('/contact', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.posted_successfully) {
          message.textContent = '{{ success_message | default: "Thank you for subscribing!" }}';
          message.className = 'newsletter-signup-{{ section_id }}__message newsletter-signup-{{ section_id }}__message--success';
          form.reset();
        } else {
          message.textContent = 'Something went wrong. Please try again.';
          message.className = 'newsletter-signup-{{ section_id }}__message newsletter-signup-{{ section_id }}__message--error';
        }
      })
      .catch(error => {
        message.textContent = 'Something went wrong. Please try again.';
        message.className = 'newsletter-signup-{{ section_id }}__message newsletter-signup-{{ section_id }}__message--error';
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Newsletter Signup",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Join Our Community"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Subtext",
      "default": "Get exclusive offers and updates delivered to your inbox."
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Thank you for subscribing!"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f5f5f5",
      "info": "Used when no background image is set"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Overlay Opacity",
      "default": 20
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Glassmorphism"
    },
    {
      "type": "checkbox",
      "id": "glass_enabled",
      "label": "Enable Glassmorphism",
      "default": true
    },
    {
      "type": "range",
      "id": "glass_blur",
      "min": 0,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Blur Amount",
      "default": 20
    },
    {
      "type": "range",
      "id": "glass_bg_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Background Opacity",
      "default": 40
    },
    {
      "type": "range",
      "id": "glass_border_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Border Opacity",
      "default": 30
    },
    {
      "type": "header",
      "content": "Fallback Styling",
      "info": "Used when glassmorphism is disabled"
    },
    {
      "type": "color",
      "id": "content_bg_color",
      "label": "Content Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "content_bg_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Content Background Opacity",
      "default": 90
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Newsletter Signup"
    }
  ]
}
{% endschema %}

