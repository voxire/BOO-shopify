{%- liquid
  assign section_id = section.id
  assign logo = section.settings.logo
  assign menu = section.settings.menu
  assign cta_label = section.settings.cta_label
  assign cta_link = section.settings.cta_link
  assign text_color = section.settings.text_color
  assign bg_color = section.settings.background_color
  assign bg_opacity = section.settings.background_opacity | divided_by: 100.0
  assign glass_enabled = section.settings.glass_enabled
  assign glass_blur = section.settings.glass_blur
  assign glass_bg_opacity = section.settings.glass_bg_opacity | divided_by: 100.0
  assign glass_border_opacity = section.settings.glass_border_opacity | divided_by: 100.0
  assign sticky_enabled = section.settings.sticky_enabled
  assign font_size = section.settings.font_size
-%}

{%- style -%}
  {% if sticky_enabled %}
    .shopify-section[data-section-id="{{ section.id }}"] {
      position: sticky !important;
      top: 0;
      z-index: 9999;
      overflow: visible;
    }
  {% else %}
    .shopify-section[data-section-id="{{ section.id }}"] {
      position: relative;
    }
  {% endif %}

  .embedded-header-{{ section_id }},
  .embedded-header-{{ section_id }}__inner,
  .embedded-header-{{ section_id }}__container {
    overflow: visible;
    transform: none;
  }

  .embedded-header-{{ section_id }} {
    position: relative;
    width: 100%;
    padding: 1.5rem 2rem;
    transition: background-color 0.3s ease, backdrop-filter 0.3s ease;
    margin: 0;
    display: block;
  }

  {% if glass_enabled %}
    .embedded-header-{{ section_id }}__inner {
      background: {{ bg_color | color_modify: 'alpha', glass_bg_opacity }};
      backdrop-filter: blur({{ glass_blur }}px) saturate(180%);
      -webkit-backdrop-filter: blur({{ glass_blur }}px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, {{ glass_border_opacity }});
      border-radius: 16px;
      padding: 1rem 2rem;
    }
  {% else %}
    .embedded-header-{{ section_id }}__inner {
      background: {{ bg_color | color_modify: 'alpha', bg_opacity }};
      padding: 0;
    }
  {% endif %}

  .embedded-header-{{ section_id }}__container {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  .embedded-header-{{ section_id }}__logo {
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .embedded-header-{{ section_id }}__logo img {
    max-height: 80px;
    width: auto;
    height: auto;
    object-fit: contain;
  }

  .embedded-header-{{ section_id }}__nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .embedded-header-{{ section_id }}__menu {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .embedded-header-{{ section_id }}__menu-item {
    margin: 0;
  }

  .embedded-header-{{ section_id }}__menu-link {
    color: {{ text_color }};
    text-decoration: none;
    font-size: {{ font_size }}px;
    font-weight: 500;
    letter-spacing: 0.02em;
    transition: opacity 0.2s ease;
    display: block;
  }

  .embedded-header-{{ section_id }}__menu-link:hover {
    opacity: 0.7;
  }

  .embedded-header-{{ section_id }}__cta {
    flex-shrink: 0;
  }

  .embedded-header-{{ section_id }}__cta-button {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: {{ text_color }};
    color: {{ bg_color }};
    text-decoration: none;
    border-radius: 8px;
    font-size: {{ font_size | times: 0.95 | round }}px;
    font-weight: 600;
    transition: transform 0.2s ease, opacity 0.2s ease;
    border: none;
    cursor: pointer;
  }

  .embedded-header-{{ section_id }}__cta-button:hover {
    transform: translateY(-1px);
    opacity: 0.9;
  }

  /* Mobile menu button */
  .embedded-header-{{ section_id }}__menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    flex-shrink: 0;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    min-width: 44px;
    min-height: 44px;
    touch-action: manipulation;
  }

  .embedded-header-{{ section_id }}__menu-toggle-icon {
    display: flex;
    flex-direction: column;
    gap: 5px;
    width: 24px;
    height: 18px;
    position: relative;
  }

  .embedded-header-{{ section_id }}__menu-toggle-line {
    width: 100%;
    height: 2px;
    background-color: {{ text_color }};
    transition: transform 0.3s ease, opacity 0.3s ease;
    border-radius: 1px;
  }

  .embedded-header-{{ section_id }}__menu-toggle[aria-expanded="true"] .embedded-header-{{ section_id }}__menu-toggle-line:nth-child(1) {
    transform: rotate(45deg) translate(7px, 7px);
  }

  .embedded-header-{{ section_id }}__menu-toggle[aria-expanded="true"] .embedded-header-{{ section_id }}__menu-toggle-line:nth-child(2) {
    opacity: 0;
  }

  .embedded-header-{{ section_id }}__menu-toggle[aria-expanded="true"] .embedded-header-{{ section_id }}__menu-toggle-line:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Mobile menu */
  .embedded-header-{{ section_id }}__mobile-nav {
    display: none;
    width: 100%;
    flex-basis: 100%;
    order: 3;
  }

  .embedded-header-{{ section_id }}__mobile-menu {
    list-style: none;
    margin: 0;
    padding: 1rem 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .embedded-header-{{ section_id }}__mobile-menu-item {
    margin: 0;
  }

  .embedded-header-{{ section_id }}__mobile-menu-link {
    color: {{ text_color }};
    text-decoration: none;
    font-size: {{ font_size }}px;
    font-weight: 500;
    letter-spacing: 0.02em;
    display: block;
    padding: 0.75rem 0;
    transition: opacity 0.2s ease;
  }

  .embedded-header-{{ section_id }}__mobile-menu-link:hover,
  .embedded-header-{{ section_id }}__mobile-menu-link:active {
    opacity: 0.7;
  }

  @media screen and (max-width: 990px) {
    .embedded-header-{{ section_id }} {
      padding: 1rem 1.5rem;
    }

    {% if glass_enabled %}
      .embedded-header-{{ section_id }}__inner {
        padding: 0.75rem 1.5rem;
      }
    {% endif %}

    .embedded-header-{{ section_id }}__container {
      gap: 1rem;
    }

    .embedded-header-{{ section_id }}__menu {
      gap: 1rem;
    }

    .embedded-header-{{ section_id }}__menu-link {
      font-size: {{ font_size | times: 0.9 | round }}px;
    }

    .embedded-header-{{ section_id }}__cta-button {
      padding: 0.6rem 1.2rem;
      font-size: {{ font_size | times: 0.85 | round }}px;
    }
  }

  @media screen and (max-width: 768px) {
    .embedded-header-{{ section_id }} {
      width: 100%;
      overflow-x: hidden;
      padding: 1rem 1rem;
    }

    .embedded-header-{{ section_id }}__inner {
      position: relative;
      width: 100%;
      max-width: 100%;
    }

    {% if glass_enabled %}
      .embedded-header-{{ section_id }}__inner {
        padding: 0.75rem 1rem;
      }
    {% endif %}

    .embedded-header-{{ section_id }}__container {
      width: 100%;
      max-width: 100%;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .embedded-header-{{ section_id }}__nav {
      display: none;
    }

    .embedded-header-{{ section_id }}__menu-toggle {
      display: flex;
    }

    .embedded-header-{{ section_id }}__mobile-nav {
      display: block;
    }

    .embedded-header-{{ section_id }}__mobile-nav[aria-hidden="true"] {
      display: none;
    }

    .embedded-header-{{ section_id }}__logo {
      flex: 1 1 auto;
    }

    .embedded-header-{{ section_id }}__logo img {
      max-height: 60px;
      max-width: 100%;
      width: auto;
      height: auto;
    }

    .embedded-header-{{ section_id }}__cta {
      flex: 1 1 100%;
      width: 100%;
      order: 4;
    }

    .embedded-header-{{ section_id }}__cta-button {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      text-align: center;
      transform: none;
      white-space: normal;
    }

    .embedded-header-{{ section_id }}__cta-button:hover {
      transform: none;
    }
  }
{%- endstyle -%}

<header class="embedded-header-{{ section_id }}" role="banner">
  <div class="embedded-header-{{ section_id }}__inner">
    <div class="embedded-header-{{ section_id }}__container">
      {%- if logo != blank -%}
        <div class="embedded-header-{{ section_id }}__logo">
          <a href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
            {{ logo | image_url: width: 200 | image_tag: alt: shop.name, loading: 'eager' }}
          </a>
        </div>
      {%- endif -%}

      {%- if menu != blank -%}
        <button
          class="embedded-header-{{ section_id }}__menu-toggle"
          aria-label="Toggle menu"
          aria-expanded="false"
          aria-controls="mobile-nav-{{ section_id }}"
          type="button"
        >
          <span class="embedded-header-{{ section_id }}__menu-toggle-icon">
            <span class="embedded-header-{{ section_id }}__menu-toggle-line"></span>
            <span class="embedded-header-{{ section_id }}__menu-toggle-line"></span>
            <span class="embedded-header-{{ section_id }}__menu-toggle-line"></span>
          </span>
        </button>

        <nav class="embedded-header-{{ section_id }}__nav" role="navigation" aria-label="Main navigation">
          <ul class="embedded-header-{{ section_id }}__menu">
            {%- for link in linklists[menu].links -%}
              <li class="embedded-header-{{ section_id }}__menu-item">
                <a href="{{ link.url }}" class="embedded-header-{{ section_id }}__menu-link">
                  {{ link.title }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </nav>

        <nav
          class="embedded-header-{{ section_id }}__mobile-nav"
          id="mobile-nav-{{ section_id }}"
          role="navigation"
          aria-label="Mobile navigation"
          aria-hidden="true"
        >
          <ul class="embedded-header-{{ section_id }}__mobile-menu">
            {%- for link in linklists[menu].links -%}
              <li class="embedded-header-{{ section_id }}__mobile-menu-item">
                <a href="{{ link.url }}" class="embedded-header-{{ section_id }}__mobile-menu-link">
                  {{ link.title }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      {%- endif -%}

      {%- if cta_label != blank and cta_link != blank -%}
        <div class="embedded-header-{{ section_id }}__cta">
          <a href="{{ cta_link }}" class="embedded-header-{{ section_id }}__cta-button">
            {{ cta_label }}
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</header>

<script>
  (function() {
    const header = document.querySelector('.embedded-header-{{ section_id }}');
    if (!header) return;

    const menuToggle = header.querySelector('.embedded-header-{{ section_id }}__menu-toggle');
    const mobileNav = header.querySelector('.embedded-header-{{ section_id }}__mobile-nav');
    
    if (!menuToggle || !mobileNav) return;

    menuToggle.addEventListener('click', function() {
      const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
      menuToggle.setAttribute('aria-expanded', !isExpanded);
      mobileNav.setAttribute('aria-hidden', isExpanded);
      
      if (!isExpanded) {
        mobileNav.style.display = 'block';
      } else {
        mobileNav.style.display = 'none';
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
      if (!header.contains(e.target) && menuToggle.getAttribute('aria-expanded') === 'true') {
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileNav.setAttribute('aria-hidden', 'true');
        mobileNav.style.display = 'none';
      }
    });

    // Close menu when clicking on a link
    const mobileLinks = mobileNav.querySelectorAll('.embedded-header-{{ section_id }}__mobile-menu-link');
    mobileLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileNav.setAttribute('aria-hidden', 'true');
        mobileNav.style.display = 'none';
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Embedded Header",
  "tag": "header",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "text",
      "id": "cta_label",
      "label": "CTA Button Label"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "CTA Button Link"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Menu Font Size",
      "default": 16,
      "info": "Font size for menu links"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "background_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Background Opacity",
      "default": 0
    },
    {
      "type": "header",
      "content": "Glassmorphism"
    },
    {
      "type": "checkbox",
      "id": "glass_enabled",
      "label": "Enable Glassmorphism",
      "default": true
    },
    {
      "type": "range",
      "id": "glass_blur",
      "min": 0,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Blur Amount",
      "default": 20
    },
    {
      "type": "range",
      "id": "glass_bg_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Background Opacity",
      "default": 30
    },
    {
      "type": "range",
      "id": "glass_border_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Border Opacity",
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "sticky_enabled",
      "label": "Enable Sticky Behavior",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Embedded Header"
    }
  ]
}
{% endschema %}

